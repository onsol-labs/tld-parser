{"version":3,"file":"name-record-handler.js","sourceRoot":"","sources":["../../src/name-record-handler.ts"],"names":[],"mappings":"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","sourcesContent":["import { PublicKey } from \"@solana/web3.js\";\nimport { getHashedName, getNameAccountKeyWithBump, getOriginNameAccountKey } from \".\";\n\n\n/**\n * This function can be used to compute the public key of a domain or subdomain and multi-level subdomain.\n * @param domainTld The domain to compute the public key for (e.g `vlad.poor`, `ipfs.miester.poor`, 'ipfs.super.miester.poor')\n * @returns\n */\nexport const getDomainKey = async (domainTld: string, record = false) => {\n    const domainTldSplit = domainTld.split('.');\n    if (domainTldSplit.length === 3) {\n        // handles subdomains\n        const tld = '.' + domainTldSplit[2]\n        const domain = domainTldSplit[1]\n        const subDomain = domainTldSplit[0]\n        // parent key\n        const { pubkey: parentKey } = await _getNameAccount(tld);\n        // domain key\n        const { pubkey: domainKey } = await _getNameAccount(domain, parentKey);\n        // Sub domain\n        const prefix = Buffer.from([record ? 1 : 0]).toString();\n        const sub = prefix.concat(subDomain);\n        const result = await _getNameAccount(sub, domainKey);\n        return { ...result, isSub: true, parent: domainKey };\n    } else if (domainTldSplit.length === 4 && record) {\n        // handles four-level subdomain\n        const tld = '.' + domainTldSplit[3]\n        const domain = domainTldSplit[2]\n        const subDomain = domainTldSplit[1]\n        const multiLevelSubDomain = domainTldSplit[0]\n        // parent key\n        const { pubkey: parentKey } = await _getNameAccount(tld);\n        // domain key\n        const { pubkey: domainKey } = await _getNameAccount(domain, parentKey);\n        // Sub domain has to be added when we create subdomains for users which are not records\n        const { pubkey: subKey } = await _getNameAccount(\n            \"\\0\".concat(subDomain),\n            domainKey\n        );\n        // Sub record\n        const recordPrefix = Buffer.from([1]).toString();\n        const result = await _getNameAccount(recordPrefix.concat(multiLevelSubDomain), subKey);\n        return { ...result, isSub: true, parent: domainKey, isSubRecord: true };\n    } else if (domainTldSplit.length > 4) {\n        throw new Error(\"Invalid derivation input\");\n    }\n    // just a regular domainTld\n    const tldName = '.' + domainTldSplit[1];\n    const { pubkey: parentKeyDomainAccount } = await _getNameAccount(tldName);\n    const domain = domainTldSplit[0];\n    const result = await _getNameAccount(domain, parentKeyDomainAccount);\n    return { ...result, isSub: false, parent: undefined };\n};\n\n\nconst _getNameAccount = async (\n    name: string,\n    parent?: PublicKey\n) => {\n    if (!parent) {\n        parent = await getOriginNameAccountKey()\n    };\n    let hashed = getHashedName(name);\n    let [pubkey] = await getNameAccountKeyWithBump(hashed, undefined, parent);\n    return { pubkey, hashed };\n};"]}